<!DOCTYPE html>
<html>
  <head>
    <!-- no puede utiliza este odigo po derechos de autor Giovanni Ernesto rodriguez diaz  -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pintura 3d Gio</title>

    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
    <script src="https://cdn.babylonjs.com/recast.js"></script>
    <script src="https://cdn.babylonjs.com/ammo.js"></script>
    <script src="https://cdn.babylonjs.com/havok/HavokPhysics_umd.js"></script>
    <script src="https://cdn.babylonjs.com/cannon.js"></script>
    <script src="https://cdn.babylonjs.com/Oimo.js"></script>
    <script src="https://cdn.babylonjs.com/earcut.min.js"></script>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://cdn.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://cdn.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://cdn.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

    <style>
      html,
      body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #renderCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
      }

      #canvasZone {
        width: 100%;
        height: 100%;
        z-index: -1;
      }

      #idpaneldecontrol2 {
        position: absolute;
        top: 70%;
        left: 1%;

        width: auto;
        height: 80px;
        background-color: rgb(0, 0, 0);
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        justify-content: flex-start;
        align-items: flex-start;
        align-content: center;
      }

      #idpaneldecontrol2 * {
        margin-bottom: 1rem;
      }

      #idclickInputfile {
      }

      .displanenoe {
        display: none;
      }

      .clhover:hover {
        color: rgb(27, 145, 255);
        border: 3px solid rgb(27, 145, 255);
      }

      .clcirlce {
        position: relative;
        width: 20px;
        height: 79px;
        border: 3px solid #c7c7c7;
        border-radius: 50%;
        background-color: #000000b9;
        color: #ffffff;

        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: center;
        align-content: center;

        cursor: pointer;
      }

      .imfMostrar1{
        position: absolute;
        bottom:  0%;
        right: 0%;
        z-index: 1000;
        width: 140px;
        height: 130px;
        background-color: #000000b6;
      }
    </style>
  </head>

  <body>
    <div id="canvasZone"><canvas id="renderCanvas"></canvas></div>

    <div id="idpaneldecontrol2">
      <div
        id="idclickInputfile"
        class="clhover clcirlce"
        onclick="loadInputfilesIDdvv()"
      >
        &#x2681;
      </div>
      <script>
        function loadInputfilesIDdvv() {
          document.getElementById("fileInput").click();
        }
      </script>
      <input
        id="fileInput"
        class="displanenoe"
        type="file"
        accept=".glb, .obj"
      />
      <div
        id="idclickInputTexture"
        class="clhover clcirlce"
        onclick="loadInputfilesIDdvvTexture()"
      >
        &#x268F;
      </div>
      <script>
        function loadInputfilesIDdvvTexture() {
          document.getElementById("textureUploader").click();
        }
      </script>
      <input
        type="file"
        id="textureUploader"
        class="displanenoe"
        accept="image/*"
      />
    </div>
    <img id="idimggiob" class="imfMostrar1" src="" alt="" />
    <script>
  var color4Image = new Image();
var canvasdetexture = null;
var canvasidMask = null;

var laimagneesCombiandases = async (url1, url2) => {
            await loadAndResizeImage(url1, 1024, 1024);
            await loadAndResizeImageMarsk("./brush.png", 1024, 1024);
            var imagendata1 = gettImagendataGio(canvasdetexture);
            var imagendataMask = gettImagendataGio(canvasidMask);

            let combianrimgedata = combineImageData(
              imagendata1,
              imagendataMask
            );
            let context = canvasdetexture.getContext("2d");
            context.putImageData(combianrimgedata, 0, 0);
            color4Image.src = canvasdetexture.toDataURL("image/png");
          };

          
          function loadAndResizeImage(imageUrl, width = 1024, height = 1024) {
            return new Promise((resolve, reject) => {
              if (!canvasdetexture) {
                canvasdetexture = document.createElement("canvas");
              }

              canvasdetexture.id = "canvasdetexture";
              let context = canvasdetexture.getContext("2d");

              if (!context) {
                reject(
                  new Error("No se pudo obtener el contexto 2D del canvas.")
                );
                return;
              }

              canvasdetexture.width = width;
              canvasdetexture.height = height;

              const image = new Image();
              image.crossOrigin = "Anonymous";

              image.onload = function () {
                context.drawImage(image, 0, 0, width, height);
                resolve(canvasdetexture);
                if (idimggiob) {
                  idimggiob.width = width;
                  idimggiob.height = height;
                  idimggiob.src = canvasdetexture.toDataURL("image/png");
                }
              };

              image.onerror = function () {
                reject(new Error("No se pudo cargar la imagen."));
              };

              image.src = imageUrl;
            });
          }

       
          function loadAndResizeImageMarsk(
            imageUrl,
            width = 1024,
            height = 1024
          ) {
            return new Promise((resolve, reject) => {
              if (!canvasidMask) {
                canvasidMask = document.createElement("canvas");
              }

              canvasidMask.id = "idMask";
              let context = canvasidMask.getContext("2d");

              if (!context) {
                reject(
                  new Error("No se pudo obtener el contexto 2D del canvas.")
                );
                return;
              }

              canvasidMask.width = width;
              canvasidMask.height = height;

              const image = new Image();
              image.crossOrigin = "Anonymous";

              image.onload = function () {
                context.drawImage(image, 0, 0, width, height);
                resolve(canvasidMask);
              };

              image.onerror = function () {
                reject(new Error("No se pudo cargar la imagen."));
              };

              image.src = "/brush.png";
            });
          }

          function gettImagendataGio(canvas) {
            let ctx = canvas.getContext("2d");
            return ctx.getImageData(0, 0, canvas.width, canvas.height);
          }


          function combineImageData(imageData1, imageData2) {
            if (
              imageData1.width !== imageData2.width ||
              imageData1.height !== imageData2.height
            ) {
              throw new Error("Las imágenes deben tener el mismo tamaño.");
            }

            const width = imageData1.width;
            const height = imageData1.height;
            const data1 = imageData1.data;
            const data2 = imageData2.data;

            const combinedImageData = new ImageData(width, height);
            const combinedData = combinedImageData.data;

            for (let i = 0; i < data1.length; i += 4) {
              const r1 = data1[i];
              const g1 = data1[i + 1];
              const b1 = data1[i + 2];
              const a1 = data1[i + 3] / 255;

              const r2 = data2[i];
              const g2 = data2[i + 1];
              const b2 = data2[i + 2];
              const a2 = data2[i + 3] / 255;

              combinedData[i] = r1;
              combinedData[i + 1] = g1;
              combinedData[i + 2] = b1;
              combinedData[i + 3] = r2;
            }

            return combinedImageData;
          }




          //---------------------------

 


          eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('m f=50;m 16=0;11 2z=8.2z;11 1e=2B.2A("5J");11 31=g(G,1e){G.5I(g(){h(1F&&1F.5H){1F.5G()}})};11 G=15;11 d=15;11 1F=15;11 2p=g(){B j 8.5F(1e,Q,{5E:Q,5D:Q,5C:2w,})};5B 35{5A 1H 34(G){6 d=j 8.5z(G);6 43=8.5y.5x("5w/5v.5u",d);6 5t=d.5s(43,Q);6 2V=8.5r.5q("2V",{5p:1},d);m t=1g;m H=j 8.1f("2u 2t",{N:t,C:t},d);m O=H.P();O.1B="1A";O.22(0,0,t,t);H.12();m s=j 8.3l("3k",d);s.3j=H;2V.s=s;6 5o=g(K){6 M=j 8.1f("M",{N:50,C:50},d);6 A=M.P();A.1B=K;A.22(0,0,50,50);1h(m i=0;i<42;i++){A.1B=`2J(1a,1a,1a,${9.1d()*0.2})`;A.41();A.40(9.1d()*50,9.1d()*50,9.1d()*2,0,9.1t*2);A.3Z()}M.12();B M};6 2m=g(K,2U=15){B j 5n((2T)=>{6 M=j 8.1f("M",{N:50,C:50},d);6 A=M.P();h(2U){6 2n=j 3n();2n.1I=g(){A.2v(2n,0,0,50,50);M.12();2T(M)};2n.2y=2U}3r{A.1B=K;A.22(0,0,50,50);1h(m i=0;i<42;i++){A.1B=`2J(1a,1a,1a,${9.1d()*0.2})`;A.41();A.40(9.1d()*50,9.1d()*50,9.1d()*2,0,9.1t*2);A.3Z()}M.12();2T(M)}})};6 1u={3W:2m("5m"),5l:2m("5k"),5j:2m("5i"),2I:15,};2S.1I=g(){6 1W=j 8.1f("1W",{N:50,C:50},d);6 3Y=1W.P();3Y.2v(2S,0,0,50,50);1W.12();1u.2I=1W};2S.2y="5h.2x";6 2R=2B.2A("2R");2R.2o("3a",g(3X){6 20=3X.1x.1Y[0];h(20){6 1y=j 39();1y.1I=g(e){5g(e.1x.37,"./5f.2x")};1y.36(20)}});m X="3W";6 3H=g(1O){6 1v=d.3V(d.3U,d.3T);h(1v.3S&&Q){6 2l=1v.5e();h(2l){6 x=9.10(2l.x*t);6 y=9.10((1-2l.y)*t);h(1u[X]){6 5d=1u[X].P().1e;6 Z=1u[X].P().2i(0,0,50,50);6 q=O.2i(x-f/2,y-f/2,f,f);6 2k=f/2;6 2j=f/2;6 1V=(16*9.1t)/1U;1h(m i=0;i<q.k.27;i+=4){6 1E=(i/4)%f;6 1D=9.10(i/4/f);6 2f=9.2g(1V)*(1E-2k)-9.2h(1V)*(1D-2j)+2k;6 2e=9.2h(1V)*(1E-2k)+9.2g(1V)*(1D-2j)+2j;6 1b=9.10(2f*(50/f));6 1c=9.10(2e*(50/f));h(1b>=0&&1b<50&&1c>=0&&1c<50){6 Y=(1c*50+1b)*4;6 F=Z.k[Y+3]/1a;q.k[i]=Z.k[Y]*F+q.k[i]*(1-F);q.k[i+1]=Z.k[Y+1]*F+q.k[i+1]*(1-F);q.k[i+2]=Z.k[Y+2]*F+q.k[i+2]*(1-F)}}O.3R(q,x-f/2,y-f/2);H.12()}}}};6 5c=g(1O){6 1v=d.3V(d.3U,d.3T);h(1v.3S){6 1S=1v.1S;6 r=1v.5b;6 13=3Q(1S,r);h(13){6 x=9.10(13.x*t);6 y=9.10((1-13.y)*t);h(1u[X]){6 Z=1u[X].P().2i(0,0,50,50);6 q=O.2i(x-f/2,y-f/2,f,f);1h(m i=0;i<q.k.27;i+=4){6 1E=(i/4)%f;6 1D=9.10(i/4/f);6 2f=9.2g((16*9.1t)/1U)*(1E-f/2)-9.2h((16*9.1t)/1U)*(1D-f/2)+f/2;6 2e=9.2h((16*9.1t)/1U)*(1E-f/2)+9.2g((16*9.1t)/1U)*(1D-f/2)+f/2;6 1b=9.10(2f*(50/f));6 1c=9.10(2e*(50/f));h(1b>=0&&1b<50&&1c>=0&&1c<50){6 Y=(1c*50+1b)*4;6 F=Z.k[Y+3]/1a;q.k[i]=Z.k[Y]*F+q.k[i]*(1-F);q.k[i+1]=Z.k[Y+1]*F+q.k[i+1]*(1-F);q.k[i+2]=Z.k[Y+2]*F+q.k[i+2]*(1-F)}}O.3R(q,x-f/2,y-f/2);H.12()}}}};g 3Q(1S,r){6 1T=r.2G(8.24.5a);6 D=r.2G(8.24.2D);6 1C=r.59();h(1T&&D&&1C){6 3P=1C.27;m 58=15;m 57=1M.1L;1h(m i=0;i<3P;i+=3){6 2d=1C[i];6 2c=1C[i+1];6 2b=1C[i+2];6 3O=8.18.2Q(1T,2d*3);6 3N=8.18.2Q(1T,2c*3);6 3M=8.18.2Q(1T,2b*3);6 3L=D[2d*2];6 1s=D[2d*2+1];6 3K=D[2c*2];6 1r=D[2c*2+1];6 3J=D[2b*2];6 1Q=D[2b*2+1];6 19=3I(1S,3O,3N,3M);h(19){6 13={x:19.x*3L+19.y*3K+19.z*3J,y:19.x*1s+19.y*1r+19.z*1Q,};B 13}}}B{x:0,y:0}}g 3I(p,a,b,c){6 1s=b.2P(a);6 1r=c.2P(a);6 1Q=p.2P(a);6 2N=8.18.1R(1s,1s);6 1P=8.18.1R(1s,1r);6 2L=8.18.1R(1s,1Q);6 2O=8.18.1R(1r,1r);6 2M=8.18.1R(1r,1Q);6 2K=1/(2N*2O-1P*1P);6 u=(2O*2L-1P*2M)*2K;6 v=(2N*2M-1P*2L)*2K;B{x:u,y:v,z:1-u-v}}d.56.1i((1O)=>{h(1O.3b===8.55.54){3H(1O)}});6 17=8.l.53.52("51");6 3G=g(R,K,x){1w.1G(R,K,x);6 L=8.l.4Z.4Y("L"+R,R);L.N="4X";L.C="3D";L.K="1A";L.4W=K;L.1p=8.l.E.1o;L.1n=8.l.E.1m;L.1l=x;L.1k="-1N";L.4V.1i(g(){X="K"+R.4U(-1);1w.1G(X,"X")});17.1j(L)};3G("4T 4","2J(0, 0, 0, 0.5)","1N");X=\'2I\';6 J=j 8.l.3B();J.3A=0;J.3z=4S;J.w=50;J.C="1q";J.N="3y";J.1p=8.l.E.1o;J.1n=8.l.E.1m;J.1l="1N";J.1k="-3F";J.2a.1i(g(w){f=w});17.1j(J);6 W=j 8.l.2H();W.R="3Eño 29 28: 50";W.C="1q";W.K="1A";W.1p=8.l.E.1o;W.1n=8.l.E.1m;W.1l="3x";W.1k="-3F";17.1j(W);J.2a.1i(g(w){f=w;W.R="3Eño 29 28: "+9.3u(w)});6 T=j 8.l.4R();T.N="1q";T.C="1q";T.4Q=2w;T.1p=8.l.E.1o;T.1n=8.l.E.1m;T.1l="1N";T.1k="-3C";T.4P.1i(g(w){4O=w;2C.4N(1e);h(!w){2C.4M(1e,Q)}});17.1j(T);6 14=j 8.l.2H();14.R="4L 4Kón";14.C="1q";14.K="1A";14.1p=8.l.E.1o;14.1n=8.l.E.1m;14.1l="3D";14.1k="-3C";17.1j(14);6 I=j 8.l.3B();I.3A=0;I.3z=4J;I.w=0;I.C="1q";I.N="3y";I.1p=8.l.E.1o;I.1n=8.l.E.1m;I.1l="1N";I.1k="-3w";I.2a.1i(g(w){16=w});17.1j(I);6 S=j 8.l.2H();S.R="3vón 29 28: 0°";S.C="1q";S.K="1A";S.1p=8.l.E.1o;S.1n=8.l.E.1m;S.1l="3x";S.1k="-3w";17.1j(S);I.2a.1i(g(w){16=w;S.R="3vón 29 28: "+9.3u(w)+"°"});g 4I(d,4H){6 s=j 8.3i("1z",d);s.3h=H.4G();s.3g=0.5;s.3f=0.5;B s}g 3c(r){6 D=r.2G(8.24.2D);h(!D){1w.4F("4E 3t k 4D 1h 2q r.");B}m 1K=1M.1L,26=-1M.1L;m 1J=1M.1L,25=-1M.1L;1h(m i=0;i<D.27;i+=2){6 u=D[i];6 v=D[i+1];h(u<1K)1K=u;h(u>26)26=u;h(v<1J)1J=v;h(v>25)25=v}6 2F=26-1K;6 2E=25-1J;1w.1G(`3t 4C-U:${2F},V:${2E}`);6 3q=D.4B((13,3s)=>{h(3s%2===0){B(13-1K)/2F}3r{B(13-1J)/2E}});r.4A(8.24.2D,3q);1w.1G("4z 4y 4x 4w.")}d.4v(Q,Q,Q);m 2C=15;d.4u.4t({4s:Q});6 4r=1g;6 4q=j 8.1f("2u 2t",{N:t,C:t},d);6 4p=H.P();6 1Z=2B.2A("4o");11 38=1H(3o)=>{d.3e.2s((r)=>{h(r.2r!=="3d"){r.3p()}});d.4n.2s((s)=>{h(s.2r!=="4m"){s.3p()}});33 8.2z.4l(3o,"",d);6 23=j 3n();23.2y="4k.2x";23.1I=()=>{m 21=j 8.1f("H",{N:1g,C:1g},d,2w);m 3m=21.P();3m.2v(23,0,0,1g,1g);21.12();t=1g;H=j 8.1f("2u 2t",{N:t,C:t},d);O=H.P();O.1B="1A";O.22(0,0,t,t);H.12();s=j 8.3l("3k",d);s.3j=H;m 1z=j 8.3i("1z",d);1z.3h=21;1z.3g=0.7;1z.3f=0.2;d.3e.2s((r)=>{h(r.2r!=="3d"){r.s=s;3c(r)}})}};1Z.3b="20";1Z.4j=".4i, .4h";1Z.2o("3a",1H(e)=>{h(e.1x.1Y&&e.1x.1Y[0]){6 1y=j 39();1y.1I=(e)=>{38(e.1x.37,d)};1y.36(e.1x.1Y[0])}});B d}}30=g(){B 35.34(G,G.4g())};1X.2Z=1H g(){11 32=1H g(){4f{B 2p()}4e(e){1w.1G("2q 4d 4c g 4b. 4a 2q 49 G 48");B 2p()}};1X.G=33 32();h(!G)47"G 46 45 44 15.";31(G,1e);1X.d=30()};2Z().2Y(()=>{d.2Y((2X)=>{1F=2X})});1X.2o("2W",g(){G.2W()});',62,356,'||||||const||BABYLON|Math||||scene||brushSize|function|if||new|data|GUI|let||||cubeImageData|mesh|material|textureResolution|||value||||brushContext|return|height|uvs|Control|alpha|engine|dynamicTexture|brushRotationSlider|brushSizeSlider|color|button|brushTexture|width|textureContext|getContext|true|text|brushRotationText|lockRotationCheckbox|||brushSizeText|currentBrush|brushIndex|brushImageData|floor|var|update|uv|lockRotationText|null|brushRotation|advancedTexture|Vector3|barycentric|255|brushX|brushY|random|canvas|DynamicTexture|1024|for|add|addControl|top|left|VERTICAL_ALIGNMENT_BOTTOM|verticalAlignment|HORIZONTAL_ALIGNMENT_LEFT|horizontalAlignment|20px|v1|v0|PI|brushTextures|pickResult|console|target|reader|pbrMaterial|white|fillStyle|indices|pixelY|pixelX|sceneToRender|log|async|onload|minV|minU|MAX_VALUE|Number|10px|pointerInfo|dot01|v2|Dot|pickedPoint|positions|180|rad|color4Texture|window|files|input|file|dynamicTexturev|fillRect|image|VertexBuffer|maxV|maxU|length|brocha|de|onValueChangedObservable|i2|i1|i0|rotatedY|rotatedX|cos|sin|getImageData|centerY|centerX|faceUV|createBrushTexture|img|addEventListener|createDefaultEngine|the|name|forEach|texture|dynamic|drawImage|false|png|src|SceneLoader|getElementById|document|camera|UVKind|scaleV|scaleU|getVerticesData|TextBlock|color4|rgba|invDenom|dot02|dot12|dot00|dot11|subtract|FromArray|textureUploader|color4Image|resolve|imageUrl|cube|resize|returnedScene|then|initFunction|createScene|startRenderLoop|asyncEngineCreation|await|CreateScene|Playground|readAsDataURL|result|loasExternaObj|FileReader|change|type|adjustUVScale|hdrSkyBox|meshes|roughness|metallic|albedoTexture|PBRMaterial|diffuseTexture|cubeMaterial|StandardMaterial|ctxv|Image|url|dispose|adjustedUVs|else|index|UV|round|Rotaci|120px|220px|200px|maximum|minimum|Slider|90px|40px|Tama|60px|addButton|paint|getBarycentric|u2|u1|u0|p2|p1|p0|numIndices|getUVFrom3DPoint|putImageData|hit|pointerY|pointerX|pick|color1|event|color4Context|fill|arc|beginPath|500|hdrTexture|be|not|should|throw|instead|default|Creating|failed|createEngine|available|catch|try|getRenderingCanvas|obj|glb|accept|b1|AppendAsync|skyBox|materials|fileInput|textureContext3|dynamicTexture3|textureResolution4|embedMode|show|debugLayer|createDefaultCameraOrLight|applied|and|adjusted|UVs|setVerticesData|map|Scale|found|No|warn|clone|urlAlbedoTexture|createPBRMaterial|360|rotaci|Bloquear|attachControl|detachControl|isRotationLocked|onIsCheckedChangedObservable|isChecked|Checkbox|1000|Color|slice|onPointerUpObservable|background|100px|CreateSimpleButton|Button||UI|CreateFullscreenUI|AdvancedDynamicTexture|POINTERDOWN|PointerEventTypes|onPointerObservable|minDistance|closestUV|getIndices|PositionKind|pickedMesh|paintnunca|brushCanvas|getTextureCoordinates|brush|laimagneesCombiandases|apintarB|green|color3|blue|color2|red|Promise|createBrushTextureantes|size|CreateBox|MeshBuilder|createDefaultSkybox|currentSkybox|dds|environment|textures|CreateFromPrefilteredData|CubeTexture|Scene|static|class|disableWebGL2Support|stencil|preserveDrawingBuffer|Engine|render|activeCamera|runRenderLoop|renderCanvas'.split('|'),0,{}))

    </script>
  </body>
</html>
